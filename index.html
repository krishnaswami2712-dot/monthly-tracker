<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<title>Monthly Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: system-ui, sans-serif;
    background: #0b0b0b;
    color: #eaeaea;
    margin: 0;
    padding: 12px;
}

h1 { font-size: 16px; font-weight: 500; margin-bottom: 4px; }

#quote {
    font-size: 12px;
    color: #9f9f9f;
    font-style: italic;
    margin-bottom: 4px;
}

#dateTime {
    font-size: 11px;
    color: #8f8f8f;
    margin-bottom: 8px;
}

/* XP HUD */
#xpHud {
    background: #111;
    border: 1px solid #222;
    padding: 10px;
    margin-bottom: 10px;
}

#xpLevel { font-size: 13px; margin-bottom: 6px; }
#xpNumbers { font-size: 11px; color: #aaa; margin-top: 4px; }

#xpBar {
    height: 8px;
    background: #222;
    border-radius: 4px;
    overflow: hidden;
}

#xpFill { height: 100%; background: #3ddc84; }

/* Buttons */
button {
    margin: 6px 6px 10px 0;
    padding: 6px 10px;
    font-size: 11px;
    background: #111;
    color: #eaeaea;
    border: 1px solid #333;
    cursor: pointer;
}

/* Table */
.table-wrap { overflow-x: auto; border: 1px solid #222; }

table {
    border-collapse: collapse;
    background: #111;
    font-size: 12px;
}

th, td {
    border: 1px solid #222;
    padding: 6px;
    text-align: center;
}

th { color: #aaa; font-weight: 400; }

th.task, td.task {
    position: sticky;
    left: 0;
    background: #111;
    min-width: 220px;
    z-index: 2;
}

input[type="text"] {
    width: 100%;
    background: transparent;
    border: none;
    color: #eaeaea;
    font-size: 12px;
}

input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #3ddc84;
}

/* Charts */
#charts {
    margin-top: 10px;
    display: flex;
    gap: 10px;
    overflow-x: auto;
}

.task-chart {
    background: #111;
    border: 1px solid #222;
    padding: 8px;
    min-width: 140px;
    position: relative;
}

.task-chart h3 {
    font-size: 11px;
    color: #aaa;
    text-align: center;
}

.task-chart canvas {
    width: 120px !important;
    height: 120px !important;
}

.percent {
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    font-weight: 600;
    color: #3ddc84;
}

/* Overall */
#overallBox {
    margin-top: 14px;
    background: #111;
    border: 1px solid #222;
    padding: 10px;
    max-width: 260px;
    position: relative;
}

#overallBox h3 {
    font-size: 12px;
    color: #aaa;
    text-align: center;
}

#overallPercent {
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    font-weight: 600;
    color: #3ddc84;
}
</style>
</head>

<body>

<h1>Monthly Tracker</h1>
<div id="quote"></div>
<div id="dateTime"></div>

<div id="xpHud">
    <div id="xpLevel"></div>
    <div id="xpBar"><div id="xpFill"></div></div>
    <div id="xpNumbers"></div>
</div>

<button onclick="resetMonth()">Reset for New Month</button>
<button onclick="addTask()">Add Task</button>
<button onclick="location.href='growth.html'">View Growth</button>

<div class="table-wrap">
<table id="tracker">
<thead>
<tr><th class="task">Task</th></tr>
</thead>
<tbody></tbody>
</table>
</div>

<div id="charts"></div>

<div id="overallBox">
    <h3>Overall Growth</h3>
    <canvas id="overallChart" width="220" height="220"></canvas>
    <div id="overallPercent"></div>
</div>

<script>
/* ===== DATE & TIME ===== */
function updateDateTime() {
    const el = document.getElementById("dateTime");
    const now = new Date();

    const date = now.toLocaleDateString(undefined, {
        weekday: "short", day: "numeric", month: "short", year: "numeric"
    });

    const time = now.toLocaleTimeString(undefined, {
        hour: "2-digit", minute: "2-digit", second: "2-digit"
    });

    el.textContent = `ðŸ“… ${date}   â° ${time}`;
}

/* ===== MONTH HANDLING ===== */
const today = new Date();
const DAYS = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
const monthKey = today.getFullYear() + "-" + today.getMonth();
const storedMonth = localStorage.getItem("monthKey");

/* ===== DATA ===== */
let data = JSON.parse(localStorage.getItem("monthlyTracker")) || [];
let xp = Number(localStorage.getItem("xp")) || 0;

/* Auto reset only progress */
if (storedMonth && storedMonth !== monthKey) {
    if (confirm("New month detected. Reset progress for new month?")) {
        data = data.map(t => ({ name: t.name, days: Array(DAYS).fill(false) }));
    }
}
localStorage.setItem("monthKey", monthKey);

/* ===== LEVELS ===== */
const levels = [
    {emoji:"ðŸŒ±",name:"Newcomer"},{emoji:"ðŸ§­",name:"Beginner"},
    {emoji:"ðŸ”",name:"Focused"},{emoji:"ðŸ§ ",name:"Disciplined"},
    {emoji:"ðŸ”",name:"Consistent"},{emoji:"ðŸ”¥",name:"Determined"},
    {emoji:"âš”ï¸",name:"Relentless"},{emoji:"ðŸ†",name:"Elite"},
    {emoji:"ðŸ‘‘",name:"Master"},{emoji:"ðŸ‰",name:"Legendary"}
];

function getLevel() {
    let lvl = 1, rem = xp;
    while (rem >= lvl * 100) { rem -= lvl * 100; lvl++; }
    const info = levels[lvl-1] || {emoji:"ðŸš€",name:`Level ${lvl}`};
    return {lvl, ...info, rem, need:lvl*100};
}

/* ===== QUOTES ===== */
const quotes = ["Consistency beats motivation.","Win the day.","Discipline is freedom.","Small steps every day."];
function loadQuote() {
    const key = new Date().toDateString();
    const saved = JSON.parse(localStorage.getItem("dailyQuote"));
    if (saved && saved.date === key) quote.textContent = saved.quote;
    else {
        const q = quotes[Math.floor(Math.random()*quotes.length)];
        localStorage.setItem("dailyQuote",JSON.stringify({date:key,quote:q}));
        quote.textContent = q;
    }
}

/* ===== HEADER ===== */
const header = document.querySelector("#tracker thead tr");
for (let d = 1; d <= DAYS; d++) {
    const th = document.createElement("th");
    th.textContent = d;
    header.appendChild(th);
}

/* ===== FUNCTIONS ===== */
function addTask() {
    data.push({ name:"", days:Array(DAYS).fill(false) });
    save();
}

function resetMonth() {
    if (!confirm("Reset progress for this month?")) return;
    data = data.map(t => ({ name:t.name, days:Array(DAYS).fill(false) }));
    save();
}

function toggleDay(t, d, checked) {
    const prev = data[t].days[d];

    if (checked && !prev) xp += 10;
    if (!checked && prev) xp -= 10;

    if (xp < 0) xp = 0;   // ðŸ”’ HARD SAFETY LOCK

    data[t].days[d] = checked;
    save();
}


function renderAll() {
    renderTable(); renderCharts(); renderOverall(); renderXP();
}

function renderTable() {
    const tbody = document.querySelector("#tracker tbody");
    tbody.innerHTML = "";
    data.forEach((task,i)=>{
        const row = tbody.insertRow();
        const cell = row.insertCell();
        cell.className="task";
        const input = document.createElement("input");
        input.value = task.name;
        input.oninput = () => {
input.onblur = () => {
    save(); // update charts & XP after you finish typing
};
    data[i].name = input.value;
    localStorage.setItem("monthlyTracker", JSON.stringify(data));
};
        cell.appendChild(input);
        task.days.forEach((v,d)=>{
            const c = row.insertCell();
            const cb = document.createElement("input");
            cb.type="checkbox"; cb.checked=v;
            cb.onchange=()=>toggleDay(i,d,cb.checked);
            c.appendChild(cb);
        });
    });
}

function renderCharts() {
    charts.innerHTML="";
    data.forEach(t=>{
        const done=t.days.filter(Boolean).length;
        const pct=Math.round(done/DAYS*100);
        const box=document.createElement("div");
        box.className="task-chart";
        box.innerHTML=`<h3>${t.name||"Task"}</h3><canvas></canvas><div class="percent">${pct}%</div>`;
        charts.appendChild(box);
        new Chart(box.querySelector("canvas"),{
            type:"pie",
            data:{datasets:[{data:[done,DAYS-done],backgroundColor:["#3ddc84","#222"]}]},
            options:{responsive:false,plugins:{legend:{display:false}}}
        });
    });
}

let overall;
function renderOverall() {
    let done=0,total=0;
    data.forEach(t=>t.days.forEach(d=>{total++; if(d) done++;}));
    overallPercent.textContent = total?Math.round(done/total*100)+"%":"0%";
    if (overall) overall.destroy();
    overall = new Chart(overallChart,{
        type:"pie",
        data:{datasets:[{data:[done,total-done],backgroundColor:["#3ddc84","#222"]}]},
        options:{plugins:{legend:{display:false}}}
    });
}

function renderXP() {
    const l = getLevel();
    xpLevel.textContent = `${l.emoji} Level ${l.lvl} â€” ${l.name}`;
    xpFill.style.width = (l.rem/l.need*100)+"%";
    xpNumbers.textContent = `${l.rem} / ${l.need} XP`;
}

function save() {
    localStorage.setItem("monthlyTracker",JSON.stringify(data));
    localStorage.setItem("xp",xp);
    renderAll();
}

/* ===== INIT ===== */
window.onload = () => {
    loadQuote();
    updateDateTime();
    setInterval(updateDateTime,1000);
    renderAll();
};
</script>

</body>
</html>
