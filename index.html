<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- iPhone app behavior -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<!-- APP ICON -->
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<title>Monthly Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0b0b0b;
    color: #eaeaea;
    margin: 0;
    padding: 12px;
}

h1 {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 4px;
}

#quote {
    font-size: 12px;
    color: #9f9f9f;
    margin-bottom: 10px;
    font-style: italic;
}

/* TABLE */
.table-wrap {
    overflow-x: auto;
    border: 1px solid #222;
}

table {
    border-collapse: collapse;
    font-size: 12px;
    background: #111;
    min-width: 1000px;
}

th, td {
    border: 1px solid #222;
    padding: 6px;
    text-align: center;
}

th {
    color: #aaa;
    font-weight: 400;
}

th.task, td.task {
    position: sticky;
    left: 0;
    background: #111;
    z-index: 2;
    min-width: 220px;
}

input[type="text"] {
    width: 100%;
    border: none;
    background: transparent;
    color: #eaeaea;
    font-size: 12px;
    outline: none;
}

input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #3ddc84;
}

/* BUTTON */
button {
    margin-top: 8px;
    padding: 8px 12px;
    font-size: 12px;
    border: 1px solid #333;
    background: #0b0b0b;
    color: #eaeaea;
    cursor: pointer;
}

/* CHART ROW */
#charts {
    margin-top: 12px;
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 6px;
}

.task-chart {
    background: #111;
    border: 1px solid #222;
    padding: 8px;
    min-width: 140px;
    max-width: 140px;
    position: relative;
    flex-shrink: 0;
}

.task-chart h3 {
    font-size: 11px;
    font-weight: 400;
    color: #aaa;
    margin-bottom: 4px;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.task-chart canvas {
    width: 120px !important;
    height: 120px !important;
    display: block;
    margin: 0 auto;
}

.percent {
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    font-weight: 600;
    color: #3ddc84;
    pointer-events: none;
}
</style>
</head>
<body>

<h1>Monthly Tracker</h1>
<div id="quote"></div>

<div class="table-wrap">
<table id="tracker">
<thead>
<tr>
    <th class="task">Task</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<button onclick="addTask()">Add task</button>

<div id="charts"></div>

<script>
const DAYS = 31;
const STORAGE_KEY = "monthlyTracker";

/* DATA */
let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

/* DAILY QUOTES */
const quotes = [
    "Consistency beats motivation.",
    "Small steps every day.",
    "Discipline is freedom.",
    "Progress, not perfection.",
    "Show up even when you donâ€™t feel like it.",
    "Your future self is watching.",
    "Days decide decades.",
    "Win the day."
];

function loadQuote() {
    const today = new Date().toDateString();
    const saved = JSON.parse(localStorage.getItem("dailyQuote"));

    if (saved && saved.date === today) {
        quote.textContent = saved.quote;
        return;
    }

    const q = quotes[Math.floor(Math.random() * quotes.length)];
    localStorage.setItem("dailyQuote", JSON.stringify({ date: today, quote: q }));
    quote.textContent = q;
}

/* TABLE HEADER */
const header = document.querySelector("#tracker thead tr");
for (let d = 1; d <= DAYS; d++) {
    const th = document.createElement("th");
    th.textContent = d;
    header.appendChild(th);
}

/* TABLE */
function renderTable() {
    const tbody = document.querySelector("#tracker tbody");
    tbody.innerHTML = "";

    data.forEach((task, i) => {
        const row = tbody.insertRow();

        const nameCell = row.insertCell();
        nameCell.className = "task";
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Task name";
        input.value = task.name;
        input.oninput = () => {
            data[i].name = input.value;
            save();
        };
        nameCell.appendChild(input);

        task.days.forEach((done, d) => {
            const cell = row.insertCell();
            const cb = document.createElement("input");
            cb.type = "checkbox";
            cb.checked = done;
            cb.onchange = () => {
                data[i].days[d] = cb.checked;
                save();
            };
            cell.appendChild(cb);
        });
    });
}

/* CHARTS */
function renderCharts() {
    const container = document.getElementById("charts");
    container.innerHTML = "";

    data.forEach((task, i) => {
        const completed = task.days.filter(Boolean).length;
        const percent = Math.round((completed / DAYS) * 100);

        const box = document.createElement("div");
        box.className = "task-chart";

        const title = document.createElement("h3");
        title.textContent = task.name || `Task ${i + 1}`;

        const canvas = document.createElement("canvas");
        const percentText = document.createElement("div");
        percentText.className = "percent";
        percentText.textContent = percent + "%";

        box.appendChild(title);
        box.appendChild(canvas);
        box.appendChild(percentText);
        container.appendChild(box);

        new Chart(canvas, {
            type: "pie",
            data: {
                labels: ["Done", "Left"],
                datasets: [{
                    data: [completed, DAYS - completed],
                    backgroundColor: ["#3ddc84", "#222"]
                }]
            },
            options: {
                responsive: false,
                plugins: { legend: { display: false } }
            }
        });
    });
}

/* CORE */
function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    renderCharts();
}

function addTask() {
    data.push({ name: "", days: Array(DAYS).fill(false) });
    renderTable();
    save();
}

/* INIT */
window.onload = () => {
    loadQuote();
    renderTable();
    renderCharts();
};
</script>

</body>
</html>
